---
title: "social nets  models"
output: html_document
---

This Rmd does all the mixed models using the data from recoding covariates.Rmd

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r make table}
#function to make table of coefficients
make_table <- function(model){
  coef <- summary(model)$coef[2]
  confint <- data.frame(confint(model))

  colnames(confint) = c("conf.low", "conf.high")

  table_out <- round(cbind(coef, confint[4,]),3)

  table_out <- table_out %>%
    unite(CI, conf.low, conf.high, sep = ",") %>%
    mutate(CI = paste0("(", CI, ")")) %>%
    unite(coef, coef, CI, sep = " ")
}
```

# Datasets
```{r datasets}
# final_dat <- read.csv("/Users/ccalmasini/Desktop/Camilla KHANDLE/Social nets paper code/social_nets_dat.csv")
final_dat <- read.csv("social_nets_dat.csv")


#centering education at 12 and age at 65
#turning variables into factors
#dropping nas for complete case analysis
khandle1 <- final_dat %>%
  mutate(W1_EDU_new_c = W1_EDU_new - 12,
         W1_D_GENDER = factor(case_when(W1_D_GENDER == 1 ~ "Male",
                                        W1_D_GENDER == 2 ~ "Female")),
         W1_SMK = ifelse(W1_SMK == 0, "No", "Yes"),
         years_over_65 = W1_INTERVIEW_AGE - 65) %>%
  drop_na(W1_EDU_new_c, income_num, ADL_IADL, tot_drinks_week)

#turning data into long format
#each person is repeated 3 times: one for execz, one for vrmem an and one for semz
#make a r_d variable which combines race and cognitive domain
khandle1_long <- khandle1 %>%
  mutate(income_num_c = scale(income_num, center = TRUE, scale = TRUE)) %>%
  gather(cognitive_test, cognitive_score, c(execz, vrmemz, semz)) %>%
  mutate(cognitive_test =  as.factor(cognitive_test),
         STUDYID = as.factor(STUDYID)) %>%
  unite(r_d, W1_D_RACE_SUMMARY, cognitive_test, remove = FALSE) %>%
  mutate(r_d = relevel(as.factor(r_d), ref = "Asian_execz"))
```

#Integration score models

```{r F test}
#this model is to test whether we can estimate a single effect for all race/domain combinations
m1 <- lmerTest::lmer(cognitive_score ~ int_score * r_d + poly(years_over_65, 2, raw = TRUE) + W1_D_GENDER +
                       W1_EDU_new_c + (1|STUDYID), 
                     REML = FALSE, 
                     data = khandle1_long)

#f-test for the  int_score*r_d interaction term is not significant
anova(m1)

#checking for individual comparisons, int_score*asian_vrmem is significant
stargazer(summary(m1)$coef, type = "text")
```

#Adjusting for asian * vrmem and using main covs only (age, gender, education, race)
##Overall model with main covariates

```{r full sample main}
#create asian_vrmemz indicator
khandle1_long <- khandle1_long %>%
  mutate(asian_vrmemz = as.factor(ifelse(r_d == "Asian_vrmemz", 1, 0)))

#overall model
m1_main <- lmerTest::lmer(cognitive_score ~ int_score + r_d + int_score:asian_vrmemz+ poly(years_over_65, 2, raw = TRUE) + 
                       W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long)

stargazer(summary(m1_main)$coef, type = "text")

#this just gives the coefficient for int_score with 95%CI
table1 <- make_table(m1_main)
```

```{r white main}
#this model stratifies for white only
m_main_white <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "White"))


stargazer(summary(m_main_white)$coef, type = "text")

table_main_white <- make_table(m_main_white)
table_main_white
```

```{r latino main}
#latino only
m_main_latinx <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "LatinX"))


stargazer(summary(m_main_latinx)$coef, type = "text")

table_main_latinx <- make_table(m_main_latinx)
table_main_latinx
```

```{r black main}
#black only
m_main_black <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Black"))


stargazer(summary(m_main_black)$coef, type = "text")

table_main_black <- make_table(m_main_black)
table_main_black
```


```{r asian main}
#asian only
m_main_asian <- lmerTest::lmer(cognitive_score ~ int_score + r_d + int_score:asian_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                       W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Asian"))


stargazer(summary(m_main_asian)$coef, type = "text")

table_main_asian <- make_table(m_main_asian)
table_main_asian
```

```{r main covariates table}
#this puts all the coefficients + CIs together to make a tables
table_main_covs <- rbind(table1, table_main_white, table_main_black, table_main_latinx, table_main_asian)
colnames(table_main_covs) <- "Coefficient (main covariates)"
table_main_covs <- cbind('label' = c("Main covars - overall", "Main covars - white", "Main covars - black", "Main covars - latinx", "Main covars - asian"), table_main_covs)
```

# Adding other covariates (drinks, income, adl_iadl)

You used the non-centered income_num variable in these models, which is producing the warning, "Some predictor variables are on very different scales: consider rescaling."

Using the scaled version only changes the estimated intercept and the beta/CIs for the income variable. It does not change the betas or confidence intervals for the int_score, so everything is fine, but using the scaled variable will get rid of the warning.

## Overall
```{r overall & all covs}
#this is overall model also including other covariates
m2 <- lmerTest::lmer(cognitive_score ~ int_score + r_d + int_score:asian_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long)

stargazer(summary(m2)$coeff, type = "text")

table2 <- make_table(m2)
```

##White only
```{r white}
#model stratified for white + table for white
m_white <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "White"))


stargazer(summary(m_white)$coef, type = "text")

table_white <- make_table(m_white)
table_white
```

##Black only
```{r black}
#model stratified for black + table for black
m_black <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID), 
                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Black"))

stargazer(summary(m_black)$coeff, type = "text")

table_black <- make_table(m_black)
```

##Latino only
```{r latinx}
#model stratified for latino + table for latino
m_latinx <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "LatinX"))

stargazer(summary(m_latinx)$coeff, type = "text")

table_latinx <- make_table(m_latinx)
```

##Asian only
```{r asian}
#model stratified for Asian + table for asian
m_asian <- lmerTest::lmer(cognitive_score ~ int_score + r_d + int_score:asian_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Asian"))

stargazer(summary(m_asian)$coeff, type = "text")

table_asian <- make_table(m_asian)
```


```{r maketable}
#this puts all the coefficients together in a table
table_all_covs <- rbind(table2, table_white, table_black, table_latinx, table_asian)
colnames(table_all_covs) <- "Coefficient (all covariates)"
#table_all_covs <- cbind(labels, table_all_covs) 

table_overall <- cbind(table_main_covs, table_all_covs) 
table_overall$label <- c("Overall", "White", "Black", "Latinx", "Asian")
```

## Imputing

These models also use the unscaled income variable. Could change to remove error message, but not important for calculation of int_score coefficients/standard errors.

```{r}
#here i am imputing W1_EDU_new_c, income_num, ADL_IADL and tot_drinks_week
khandle_full <- final_dat %>%
  mutate(W1_EDU_new_c = W1_EDU_new - 12,
         W1_D_GENDER = case_when(W1_D_GENDER == 1 ~ "Male",
                                 W1_D_GENDER == 2 ~ "Female"),
         W1_D_GENDER = as.factor(W1_D_GENDER),
         W1_SMK = ifelse(W1_SMK == 0, "No", "Yes"),
         years_over_65 = W1_INTERVIEW_AGE - 65, 
         vrmemz = as.numeric(vrmemz),
         semz = as.numeric(semz),
         execz = as.numeric(execz)) %>%
  select(-c(W1_SMK, IADL, ADL, confidante_bin, W1_INTERVIEW_AGE, W1_EDU_new))

summary(khandle_full)

#20 imputatios on the flat dataset
imputations <- mice::mice(khandle_full, print = FALSE, seed = 123, m=20, method = "pmm")

#this gives a list with 20 datasets, one for each imputation
imp_dat <- mice::complete(imputations, "all")

#making a for loop that loops through each element of imp_dat (ie each of the 20 imputed datasets)
#and turns the data into long format
#then runs the overall model and race-stratified models adjusted for covariates
#and returns lists of coefficients and standard errors
imp_coefs <- list()
stand_errs <- list()

imp_coefs_white <- list()
stand_errs_white <- list()

imp_coefs_latinx <- list()
stand_errs_latinx <- list()

imp_coefs_black <- list()
stand_errs_black <- list()

imp_coefs_asian <- list()
stand_errs_asian <- list()


for(i in 1:20){
 tmp_dat <- imp_dat[[i]]
  
  dat_long <- tmp_dat %>%
    mutate(income_num_c = scale(income_num, center = TRUE, scale = TRUE)) %>%
    gather(cognitive_test, cognitive_score, c(execz, vrmemz, semz)) %>%
    mutate(cognitive_test =  as.factor(cognitive_test),
           STUDYID = as.factor(STUDYID)) %>%
    unite(r_d, W1_D_RACE_SUMMARY, cognitive_test, remove = FALSE) %>%
    mutate(r_d = relevel(as.factor(r_d), ref = "Asian_execz"),
           asian_vrmemz = as.factor(ifelse(r_d == "Asian_vrmemz", 1, 0))) 
  
  mod <- lmerTest::lmer(cognitive_score ~ int_score + r_d + int_score:asian_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = dat_long)
  
  mod_white <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = dat_long, subset = (W1_D_RACE_SUMMARY == "White"))
  
  mod_latinx <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = dat_long, subset = (W1_D_RACE_SUMMARY == "LatinX"))
  
  mod_black <- lmerTest::lmer(cognitive_score ~ int_score + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = dat_long, subset = (W1_D_RACE_SUMMARY == "Black"))
  
  mod_asian <- lmerTest::lmer(cognitive_score ~ int_score + int_score:asian_vrmemz + r_d + poly(years_over_65, 2, raw = TRUE) + 
                       # the line below has the uncentered income variable
                       # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num + (1|STUDYID), 
                       #  corrected line below
                       W1_D_GENDER + W1_EDU_new_c + ADL_IADL + tot_drinks_week + income_num_c + (1|STUDYID),                        REML = FALSE, data = dat_long, subset = (W1_D_RACE_SUMMARY == "Asian"))
  
  
  imp_coefs[[i]] <- summary(mod)$coef[2,1]
  stand_errs[[i]] <- summary(mod)$coef[2,2]
  
  imp_coefs_white[[i]] <- summary(mod_white)$coef[2,1]
  stand_errs_white[[i]] <- summary(mod_white)$coef[2,2]
  
  imp_coefs_latinx[[i]] <- summary(mod_latinx)$coef[2,1]
  stand_errs_latinx[[i]] <- summary(mod_latinx)$coef[2,2]
  
  imp_coefs_black[[i]] <- summary(mod_black)$coef[2,1]
  stand_errs_black[[i]] <- summary(mod_black)$coef[2,2]
  
  imp_coefs_asian[[i]] <- summary(mod_asian)$coef[2,1]
  stand_errs_asian[[i]] <- summary(mod_asian)$coef[2,2]
}

#here i am calculating the pooled coefficient and standard errors from the imputation
#for each of the models (ie overall and race-startified)
#overall pooled coefficient w/ CI
pooled_coeff <- mean(unlist(imp_coefs))

#within and between variance
within_var <- mean(unlist(stand_errs)**2)
between_var <- (sd(unlist(imp_coefs))**2)/19

#pooled error
pooled_stand_err <- sqrt(within_var+between_var)

lower_ci <- pooled_coeff - 1.96 * pooled_stand_err
upper_ci <- pooled_coeff + 1.96 * pooled_stand_err

imputed_coef_CI <- paste0(round(pooled_coeff, 3), " (", round(lower_ci, 3), ", ", round(upper_ci, 3), ")")

#white pooled coefficients
pooled_coeff_white <- mean(unlist(imp_coefs_white))

within_var_white <- mean(unlist(stand_errs_white)**2)
between_var_white <- (sd(unlist(imp_coefs_white))**2)/19

pooled_stand_err_white <- sqrt(within_var_white+between_var_white)

lower_ci_white <- pooled_coeff_white - 1.96 * pooled_stand_err_white
upper_ci_white <- pooled_coeff_white + 1.96 * pooled_stand_err_white

imputed_coef_CI_white <- paste0(round(pooled_coeff_white, 3), " (", round(lower_ci_white, 3), ", ", round(upper_ci_white, 3), ")")

#latinx pooled coefficients
pooled_coeff_latinx <- mean(unlist(imp_coefs_latinx))

within_var_latinx <- mean(unlist(stand_errs_latinx)**2)
between_var_latinx <- (sd(unlist(imp_coefs_latinx))**2)/19

pooled_stand_err_latinx <- sqrt(within_var_latinx+between_var_latinx)

lower_ci_latinx <- pooled_coeff_latinx - 1.96 * pooled_stand_err_latinx
upper_ci_latinx <- pooled_coeff_latinx + 1.96 * pooled_stand_err_latinx

imputed_coef_CI_latinx <- paste0(round(pooled_coeff_latinx, 3), " (", round(lower_ci_latinx, 3), ", ", round(upper_ci_latinx, 3), ")")

#black pooled coefficients
pooled_coeff_black <- mean(unlist(imp_coefs_black))

within_var_black <- mean(unlist(stand_errs_black)**2)
between_var_black <- (sd(unlist(imp_coefs_black))**2)/19

pooled_stand_err_black <- sqrt(within_var_black+between_var_black)

lower_ci_black <- pooled_coeff_black - 1.96 * pooled_stand_err_black
upper_ci_black <- pooled_coeff_black + 1.96 * pooled_stand_err_black

imputed_coef_CI_black <- paste0(round(pooled_coeff_black, 3), " (", round(lower_ci_black, 3), ", ", round(upper_ci_black, 3), ")")

#asian pooled coefficients
pooled_coeff_asian <- mean(unlist(imp_coefs_asian))

within_var_asian <- mean(unlist(stand_errs_asian)**2)
between_var_asian <- (sd(unlist(imp_coefs_asian))**2)/19

pooled_stand_err_asian <- sqrt(within_var_asian+between_var_asian)

lower_ci_asian <- pooled_coeff_asian - 1.96 * pooled_stand_err_asian
upper_ci_asian <- pooled_coeff_asian + 1.96 * pooled_stand_err_asian

imputed_coef_CI_asian <- paste0(round(pooled_coeff_asian, 3), " (", round(lower_ci_asian, 3), ", ", round(upper_ci_asian, 3), ")")
```

## Make the final table 
```{r imputation table & complete cases table}
table_imputation <- data.frame(rbind(imputed_coef_CI, imputed_coef_CI_white, imputed_coef_CI_black, imputed_coef_CI_latinx, imputed_coef_CI_asian), row.names = NULL)
colnames(table_imputation) <- "Coefficient (all covariates - imputed)"

table_with_imp <- cbind(table_overall, table_imputation)

#kable(table_with_imp)
```

#Confidante
This part of the code runs the models using confidante as the main independent variable instead of integration score
```{r}
table(khandle1$confidante_bin)

#confidante - f test
m_confidante <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin)*r_d + poly(years_over_65, 2, raw = TRUE) + 
                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                         REML = FALSE, data = khandle1_long)
anova(m_confidante)

stargazer(summary(m_confidante)$coeff, type = "text")
```

#Adjusting for asian vrmem and latinx vrmemz (main covariates)

```{r main conf overall}
khandle1_long <- khandle1_long %>%
  mutate(latin_vrmemz = as.factor(ifelse(r_d == "LatinX_vrmemz", 1, 0)))

m_main_confidante_overall <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):asian_vrmemz+ 
                                         as.factor(confidante_bin):latin_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long)

stargazer(summary(m_main_confidante_overall)$coeff, type = "text")

main_confidante_overall_table <- make_table(m_main_confidante_overall)
```

```{r main conf white}
m_main_confidante_white <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + poly(years_over_65, 2, raw = TRUE) + 
                                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "White"))

stargazer(summary(m_main_confidante_white)$coef, type = "text", single.row=TRUE)

main_confidante_white_table <- make_table(m_main_confidante_white)
```

```{r main conf black}
m_main_confidante_black <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + poly(years_over_65, 2, raw = TRUE) + 
                                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Black"))

stargazer(summary(m_main_confidante_black)$coef, type = "text", single.row=TRUE)

main_confidante_black_table <- make_table(m_main_confidante_black)

```

```{r main conf latino}
m_main_confidante_latinx <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):latin_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "LatinX"))

stargazer(summary(m_main_confidante_latinx)$coef, type = "text", single.row=TRUE)


main_confidante_latinx_table <- make_table(m_main_confidante_latinx)
```

```{r main conf asian}
m_main_confidante_asian <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):asian_vrmemz + 
                                         poly(years_over_65, 2, raw = TRUE) + 
                                         W1_D_GENDER + W1_EDU_new_c + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Asian"))

stargazer(summary(m_main_confidante_asian)$coef, type = "text", single.row=TRUE)

main_confidante_asian_table <- make_table(m_main_confidante_asian)

interaction.plot(x.factor = as.factor(khandle1_long$confidante_bin), 
                 trace.factor = as.factor(khandle1_long$W1_D_RACE_SUMMARY),
                 response = khandle1_long$cognitive_score)
```

Something I'm confused about that isn't a problem, just reflects my lack of understanding: why does the interaction plot not seem to match the race stratified model results? The stratified models show the largest confidante_bin coefficient for Asian participants, so I would expect Asians to have the steepest slope in the plot. That's definitely not the case. I'm guessing it is because the interaction.plot function does not account for covariates? I haven't used that function before, so I'm just curious about it's utility and interpretation.

```{r confidante table main covars}
conf_table_main <- rbind(main_confidante_overall_table, main_confidante_white_table, main_confidante_black_table, main_confidante_latinx_table, main_confidante_asian_table)
colnames(conf_table_main) <- "Coefficient (main covariates)"
```

#Adjusting for asian vrmem and latinx vrmemz (all covariates)

Again, these models use the uncentered income variable, which is causing the warning message, but isn't a problem for the int_score estimation. Should be corrected for the paper if a full results table will be included in the supplementary materials.

```{r conf full sample}
m_confidante_overall <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):asian_vrmemz + 
                                         as.factor(confidante_bin):latin_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                                         # the line below has the uncentered income variable
                                         # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num + tot_drinks_week + (1|STUDYID), 
                                         # corrected line below
                                         W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num_c + tot_drinks_week + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long)

stargazer(summary(m_confidante_overall)$coeff, type = "text")

confidante_overall_table <- make_table(m_confidante_overall)
```

```{r conf white}
m_confidante_white <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + poly(years_over_65, 2, raw = TRUE) + 
                                       # the line below has the uncentered income variable
                                         # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num + tot_drinks_week + (1|STUDYID), 
                                         # corrected line below
                                         W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num_c + tot_drinks_week + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "White"))

stargazer(summary(m_confidante_white)$coef, type = "text", single.row=TRUE)

confidante_white_table <- make_table(m_confidante_white)
```

```{r conf black}
m_confidante_black <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + poly(years_over_65, 2, raw = TRUE) + 
                                         # the line below has the uncentered income variable
                                         # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num + tot_drinks_week + (1|STUDYID), 
                                         # corrected line below
                                         W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num_c + tot_drinks_week + (1|STUDYID),                                        REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Black"))

stargazer(summary(m_confidante_black)$coef, type = "text", single.row=TRUE)

confidante_black_table <- make_table(m_confidante_black)

```

```{r conf latino}
m_confidante_latinx <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):latin_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                                         # the line below has the uncentered income variable
                                         # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num + tot_drinks_week + (1|STUDYID), 
                                         # corrected line below
                                         W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num_c + tot_drinks_week + (1|STUDYID),                                        REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "LatinX"))

stargazer(summary(m_confidante_latinx)$coef, type = "text", single.row=TRUE)

confidante_latinx_table <- make_table(m_confidante_latinx)
```

```{r conf asian}
m_confidante_asian <- lmerTest::lmer(cognitive_score ~ as.factor(confidante_bin) + r_d + as.factor(confidante_bin):asian_vrmemz + poly(years_over_65, 2, raw = TRUE) + 
                                         # the line below has the uncentered income variable
                                         # W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num + tot_drinks_week + (1|STUDYID), 
                                         # corrected line below
                                         W1_D_GENDER + W1_EDU_new_c + ADL_IADL + income_num_c + tot_drinks_week + (1|STUDYID), 
                                       REML = FALSE, data = khandle1_long, subset = (W1_D_RACE_SUMMARY == "Asian"))

stargazer(summary(m_confidante_asian)$coef, type = "text", single.row=TRUE)


confidante_asian_table <- make_table(m_confidante_asian)
```

```{r conf maketable}
conf_table_all <- rbind(confidante_overall_table, confidante_white_table, confidante_black_table, confidante_latinx_table, confidante_asian_table)
colnames(conf_table_all) <- "Coefficient (all covariates)"

#joining main covars and overall table together
confidante_table <- cbind('labels' = c("Overall", "White", "Black", "Latinx", "Asian"), conf_table_main, conf_table_all)
kable(confidante_table)
```






